import sqlite3

DB_NAME = "restaurant.db"

class User:
    def __init__(self, username, password, email):
        self.username = username
        self.password = password
        self.email = email

    def save(self):
        connection = sqlite3.connect(DB_NAME)
        cursor = connection.cursor()
        cursor.execute(
            "INSERT INTO users (username, password, email) VALUES (?, ?, ?)",
            (self.username, self.password, self.email)
        )
        connection.commit()
        connection.close()

    @staticmethod
    def get_user(username, password):
        connection = sqlite3.connect(DB_NAME)
        cursor = connection.cursor()

        cursor.execute("SELECT * FROM users WHERE username=? AND password=?", (username, password))
        user = cursor.fetchone()

        if user:
            # Increase visits count
            cursor.execute("UPDATE users SET visits = visits + 1 WHERE id=?", (user[0],))
            connection.commit()

            # Fetch updated user
            cursor.execute("SELECT * FROM users WHERE id=?", (user[0],))
            user = cursor.fetchone()

        connection.close()
        return user

    @staticmethod
    def get_user_by_id(user_id):
        conn = sqlite3.connect("restaurant.db")
        cur = conn.cursor()
        cur.execute("SELECT * FROM users WHERE id=?", (user_id,))
        user = cur.fetchone()
        conn.close()
        return user
    
    @staticmethod
    def update_wallet(user_id, new_balance):
        conn = sqlite3.connect(DB_NAME)
        cur = conn.cursor()
        cur.execute("UPDATE users SET wallet = ? WHERE id = ?", (new_balance, user_id))
        conn.commit()
        conn.close()


 
